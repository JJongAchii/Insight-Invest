# Copilot manifest for API service (Cost-Optimized)
#
# Type: Backend Service (No ALB)
# Access via: CloudFront (HTTPS) â†’ Backend Service (HTTP)

name: api
type: Backend Service

# Docker image configuration
image:
  build:
    dockerfile: server/Dockerfile
    context: ./server
  port: 8000

# Resource allocation
cpu: 256 # 0.25 vCPU
memory: 512 # 512 MB
count: 1

# Enable command execution for debugging
exec: true

# Environment variables
variables:
  ENVIRONMENT: production
  TZ: Asia/Seoul
  LOG_LEVEL: INFO
  # CORS origins - update with your actual domains
  CORS_ORIGINS: https://insight-invest-ten.vercel.app,http://localhost:3000

# Secrets from AWS Systems Manager Parameter Store
secrets:
  DATABASE_URL: /copilot/${COPILOT_APPLICATION_NAME}/${COPILOT_ENVIRONMENT_NAME}/secrets/DATABASE_URL

# Network configuration
network:
  vpc:
    placement: public

# Logging configuration
logging:
  retention: 7 # 7 days
